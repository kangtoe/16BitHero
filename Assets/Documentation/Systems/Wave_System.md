# Wave System - 웨이브 시스템 상세 기획

## 📋 문서 정보
- **작성일**: 2025-12-04
- **버전**: 0.1
- **관련 시스템**: Enemy System, Spawn System, Progression System

---

## 🎯 웨이브 시스템 개요

### 핵심 컨셉
브로타토 스타일의 **시간 제한 웨이브 서바이벌** 시스템입니다. 플레이어는 제한 시간 동안 끊임없이 스폰되는 적들을 견뎌내고, 웨이브가 끝나면 상점에서 강화 후 다음 웨이브로 진행합니다.

### 게임 루프
```
웨이브 시작
    ↓
[전투 페이즈] - 제한 시간 동안 생존
    ↓
웨이브 종료 (모든 적 자동 처치)
    ↓
[상점 페이즈] - 무기/아이템 구매 및 업그레이드
    ↓
다음 웨이브 시작
```

---

## 🔧 현재 구현 상태

### ✅ 구현 완료
1. **웨이브 관리**
   - `WaveSpawnManager.cs`로 웨이브 진행 관리
   - 웨이브별 스폰 정보 설정 (ScriptableObject 방식)
   - 웨이브 타이머 UI

2. **스폰 시스템**
   - 시간 기반 스폰 (시작 시간, 간격)
   - 확률 기반 스폰 (0~100%)
   - 스폰 수량 설정
   - 스폰 범위 설정 (플레이어 주변 원형 영역)
   - 스폰 인디케이터 (적 출현 예고)

3. **웨이브 종료**
   - 타이머 종료 시 모든 적 자동 처치
   - 웨이브 종료 콜백

### 🚧 부분 구현 / 주석 처리
1. **웨이브 전환**
   - 웨이브 종료 후 상점 전환 로직 주석 처리
   - GameState 시스템 미구현

2. **스폰 제한**
   - 최대 적 수 제한 미구현 (README TODO)

### ❌ 미구현
1. **난이도 곡선** - 웨이브별 자동 스케일링
2. **보스 웨이브** - 특정 웨이브에 보스 등장
3. **특수 웨이브** - 이벤트 웨이브, 보너스 웨이브 등
4. **웨이브 보상** - 웨이브 클리어 보상

---

## 📊 웨이브 구조

### 웨이브 데이터 구조 (현재)
```csharp
[Serializable]
public class WaveInfo
{
    public string desc;                    // 웨이브 설명
    public SpawnInfo[] spawnInfos;         // 스폰 패턴 배열
    public int waveDuration = 30;          // 웨이브 지속 시간 (초)
}

[Serializable]
public class SpawnInfo
{
    public string desc;                    // 스폰 설명
    public EnemyBase enemyBase;            // 스폰할 적 프리팹
    public int spawnChance = 100;          // 스폰 확률 (0~100)
    public float spawnStartTime = 1;       // 스폰 시작 시간
    public float spawnInterval = 1;        // 스폰 간격 (0 = 1회만)
    public int spawnAmount = 1;            // 한 번에 스폰할 수량
    public float spawnAreaRadius = 2;      // 스폰 범위 반경
}
```

### 스폰 영역
- **플레이어 중심 원형 영역**
- **최소 거리**: 5.0 (플레이어 시야 밖)
- **최대 거리**: 8.0
- **아레나 경계 체크**: 벽 안쪽에만 스폰

---

## 🎮 웨이브 디자인 가이드

### 웨이브 진행 구조 (제안)

#### 일반 웨이브 (1~4, 6~9, 11~14...)
- **지속 시간**: 30초 → 45초 → 60초 (점진적 증가)
- **목표**: 생존 + 자원 수집
- **보상**: 경험치, 골드

#### 보스 웨이브 (5, 10, 15, 20...)
- **지속 시간**: 90초
- **목표**: 보스 처치
- **보상**: 대량의 골드, 다이아몬드, 특별 아이템

#### 특수 웨이브 (선택적)
- **보너스 웨이브**: 보급품만 등장, 시간 제한 짧음
- **서바이벌 웨이브**: 적이 계속 증가, 긴 시간

---

## 📈 난이도 곡선

### 난이도 증가 요소

#### 1. **적 스탯 스케일링**
웨이브가 진행될수록 적의 기본 스탯 증가:

```
웨이브 1 기준:
- 체력: 10
- 공격력: 1
- 이동속도: 1.0

웨이브 N:
- 체력: 10 × (1 + 0.15 × (N-1))
- 공격력: 1 × (1 + 0.1 × (N-1))
- 이동속도: 1.0 × (1 + 0.05 × (N-1))

예시 (웨이브 10):
- 체력: 10 × 2.35 = 23.5 → 24
- 공격력: 1 × 1.9 = 1.9 → 2
- 이동속도: 1.0 × 1.45 = 1.45
```

#### 2. **적 수량 증가**
```
웨이브 1~3: 동시 최대 10마리
웨이브 4~6: 동시 최대 15마리
웨이브 7~9: 동시 최대 20마리
웨이브 10+: 동시 최대 25마리
```

#### 3. **적 타입 다양화**
웨이브가 진행될수록 위험한 적 등장:

| 웨이브 | 등장 적 타입 |
|--------|-------------|
| 1~2 | 기본 추적형, 배회형 |
| 3~4 | + 원거리 공격형 |
| 5 | **보스 1** |
| 6~7 | + 돌격형, 분열형 |
| 8~9 | + 탱커형 |
| 10 | **보스 2** |
| 11~14 | + 버프형, 회복형, 폭발형 |
| 15 | **보스 3** |
| 16+ | 모든 적 + 보급품 |

#### 4. **스폰 빈도 증가**
```
초반: 2~3초마다 1마리
중반: 1~2초마다 1~2마리
후반: 0.5~1초마다 2~3마리
```

---

## 🎲 웨이브별 적 구성 예시

### 웨이브 1 (튜토리얼)
**지속 시간**: 30초  
**목표**: 기본 조작 익히기

**적 구성**:
```
기본 추적형: 70% (스폰 간격 3초, 1마리씩)
배회형: 30% (스폰 간격 4초, 1마리씩)
```

**예상 총 적 수**: 약 10마리

---

### 웨이브 2~3 (초반)
**지속 시간**: 30초  
**목표**: 기본 전투 숙달

**적 구성**:
```
기본 추적형: 60% (스폰 간격 2초, 1마리씩)
배회형: 40% (스폰 간격 3초, 1마리씩)
```

**예상 총 적 수**: 약 15마리

---

### 웨이브 4 (중반 진입)
**지속 시간**: 45초  
**목표**: 새로운 적 타입 대응

**적 구성**:
```
기본 추적형: 40% (스폰 간격 2초)
배회형: 30% (스폰 간격 3초)
원거리 공격형: 30% (스폰 간격 5초, 경고 시스템)
```

**예상 총 적 수**: 약 20마리

---

### 웨이브 5 (첫 보스)
**지속 시간**: 90초  
**목표**: 보스 패턴 학습 및 처치

**적 구성**:
```
보스: 거대 슬라임 1마리 (웨이브 시작 시)
기본 추적형: 30% (스폰 간격 4초, 보조)
회복형: 10% (스폰 간격 15초, 보스 지원)
```

**특징**:
- 보스 처치 시 웨이브 즉시 종료
- 보스 미처치 시 타임오버로 실패 (선택적)

---

### 웨이브 6~9 (중반)
**지속 시간**: 45~60초  
**목표**: 다양한 위협 대응, 전략적 우선순위 판단

**적 구성 (웨이브 7 예시)**:
```
기본 추적형: 25% (스폰 간격 2초)
배회형: 15% (스폰 간격 3초)
원거리 공격형: 20% (스폰 간격 4초)
돌격형: 15% (스폰 간격 6초)
분열형: 15% (스폰 간격 5초)
탱커형: 10% (스폰 간격 10초)
```

**예상 총 적 수**: 약 30마리

---

### 웨이브 10 (두 번째 보스)
**지속 시간**: 90초  
**목표**: 강화된 보스 처치

**적 구성**:
```
보스: 거대 슬라임 (강화) 1마리
원거리 공격형: 20% (스폰 간격 5초)
회복형: 10% (스폰 간격 12초)
버프형: 5% (스폰 간격 20초)
```

**특징**:
- 보스 체력 2배
- Phase 3부터 시작

---

### 웨이브 11+ (후반)
**지속 시간**: 60초  
**목표**: 극한의 생존

**적 구성 (웨이브 12 예시)**:
```
탱커형: 10% (스폰 간격 8초)
원거리 공격형: 25% (스폰 간격 3초)
돌격형: 20% (스폰 간격 4초)
버프형: 5% (스폰 간격 15초)
회복형: 5% (스폰 간격 15초)
폭발형: 15% (스폰 간격 5초)
기본 추적형: 10% (스폰 간격 2초)
배회형: 10% (스폰 간격 3초)
```

**예상 총 적 수**: 약 40마리

---

## 🔥 특수 적 조합 (시너지)

### 1. **탱커 + 원거리** (중반~)
**전략적 난이도**: ⭐⭐⭐

**구성**:
- 탱커형 1~2마리 (앞)
- 원거리 공격형 3~4마리 (뒤)

**플레이어 대응**:
- 탱커를 우회하여 원거리 먼저 처치
- 또는 탱커를 집중 공격 (시간 소요)

**등장 웨이브**: 8~

---

### 2. **버프형 + 다수의 약한 적** (후반)
**전략적 난이도**: ⭐⭐⭐⭐

**구성**:
- 버프형 1마리 (중앙)
- 기본 추적형 10마리 (버프 받음)

**효과**:
- 버프 받은 적: 공격력 +50%, 이동속도 +30%
- 약한 적이 위협적으로 변함

**플레이어 대응**:
- 버프형을 최우선 처치
- 버프형이 도망가므로 추적 필요

**등장 웨이브**: 11~

---

### 3. **회복형 + 탱커** (후반)
**전략적 난이도**: ⭐⭐⭐⭐

**구성**:
- 탱커형 2마리
- 회복형 1마리

**효과**:
- 탱커가 지속적으로 회복됨
- 처치 시간 대폭 증가

**플레이어 대응**:
- 회복형을 먼저 제거
- 탱커와 회복형 사이를 끊어야 함

**등장 웨이브**: 12~

---

### 4. **돌격형 + 폭발형** (후반)
**전략적 난이도**: ⭐⭐⭐⭐⭐

**구성**:
- 돌격형 2~3마리
- 폭발형 3~4마리

**효과**:
- 돌격형이 플레이어를 몰아넣음
- 폭발형이 접근하여 자폭
- 회피 공간 제한

**플레이어 대응**:
- 폭발형을 원거리에서 먼저 처치
- 돌격형의 돌진 패턴 회피
- 공간 확보가 최우선

**등장 웨이브**: 13~

---

### 5. **보스 + 회복형 + 버프형** (보스 웨이브)
**전략적 난이도**: 👑 보스

**구성**:
- 보스 1마리
- 회복형 1~2마리
- 버프형 1마리

**효과**:
- 보스가 회복 + 버프 받음
- 극도로 처치 어려움

**플레이어 대응**:
- 지원 적(회복/버프)을 먼저 제거
- 보스 패턴에 집중

**등장 웨이브**: 10, 15, 20...

---

## ⏱️ 웨이브 타이밍 설계

### 웨이브 지속 시간 곡선
```
웨이브 1~3:   30초  (짧은 전투, 빠른 피드백)
웨이브 4~6:   45초  (중간 길이)
웨이브 7~9:   60초  (긴 전투, 자원 수집)
보스 웨이브:  90초  (보스 전용)
웨이브 10+:   60초  (일정 유지)
```

### 스폰 타이밍 패턴

#### 패턴 1: 균등 스폰 (초반)
```
0초: 적 2마리
3초: 적 2마리
6초: 적 2마리
...
일정한 간격으로 스폰
```

#### 패턴 2: 웨이브 스폰 (중반)
```
0초: 적 5마리 (시작 러시)
10초: 적 3마리
20초: 적 3마리
25초: 적 5마리 (마지막 러시)
```

#### 패턴 3: 점진적 증가 (후반)
```
0~20초: 2초마다 1마리
20~40초: 1초마다 2마리
40~60초: 0.5초마다 3마리 (압박 증가)
```

#### 패턴 4: 보스 패턴
```
0초: 보스 등장
15초: 보조 적 3마리
30초: 보조 적 5마리
45초: 보조 적 5마리
60초: 보조 적 10마리 (최종 압박)
```

---

## 🎁 웨이브 보상 시스템 (제안)

### 웨이브 클리어 보상
```
기본 보상:
- 골드: 50 × 웨이브 번호
- 경험치: 100 × 웨이브 번호

보너스 보상 (조건부):
- 무피해 클리어: 골드 +50%
- 빠른 클리어 (시간의 50% 이내): 골드 +30%
- 모든 적 처치: 경험치 +20%
```

### 보스 웨이브 보상
```
- 골드: 500 × (보스 번호)
- 다이아몬드: 5 × (보스 번호)
- 상자: 1~3개
- 특별 아이템 (확률)
```

---

## 🔧 구현 가이드

### Phase 1: 기본 웨이브 시스템 개선
1. **GameState 시스템 구현**
   - 웨이브 종료 후 상점 전환
   - 상점 종료 후 다음 웨이브 시작

2. **스폰 제한 시스템**
   - 최대 적 수 설정
   - 한계 초과 시 오래된 적 제거 (보상 없이)

3. **웨이브 보상 시스템**
   - 웨이브 클리어 시 골드/경험치 지급

### Phase 2: 난이도 곡선 구현
1. **적 스탯 스케일링**
   - 웨이브 번호에 따른 자동 스탯 증가
   - ScriptableObject에 스케일링 곡선 설정

2. **동적 스폰 조절**
   - 웨이브 진행에 따라 스폰 빈도 증가
   - 적 타입 비율 자동 조정

### Phase 3: 특수 웨이브
1. **보스 웨이브**
   - 5, 10, 15... 웨이브에 보스 등장
   - 보스 전용 스폰 패턴

2. **이벤트 웨이브**
   - 보너스 웨이브 (보급품만)
   - 서바이벌 웨이브 (무한 스폰)

---

## 📊 밸런싱 가이드

### 웨이브 난이도 측정
```
난이도 점수 = (적 총 체력) × (적 평균 공격력) / (웨이브 시간)

목표:
- 웨이브 1: 100점
- 웨이브 5: 500점 (5배)
- 웨이브 10: 1500점 (15배)
- 웨이브 20: 5000점 (50배)
```

### 플레이어 성장 vs 적 성장
```
플레이어 DPS 성장: 웨이브당 +20%
적 체력 성장: 웨이브당 +15%
→ 플레이어가 약간 유리하게 성장 (보상 느낌)

플레이어 체력 성장: 웨이브당 +10%
적 공격력 성장: 웨이브당 +10%
→ 균형 유지
```

### 웨이브 시간 vs 적 수
```
30초 웨이브: 10~15마리 (초반)
45초 웨이브: 20~25마리 (중반)
60초 웨이브: 30~40마리 (후반)
90초 보스: 보스 1 + 보조 20마리
```

---

## 📌 다음 단계

1. **GameState 시스템 구현**
   - 웨이브 ↔ 상점 전환 로직
   - 상태별 UI 관리

2. **난이도 스케일링 구현**
   - 적 스탯 자동 증가 시스템
   - 웨이브별 스폰 패턴 자동 조정

3. **보스 웨이브 구현**
   - 보스 등장 조건 (5, 10, 15...)
   - 보스 전용 스폰 패턴

4. **웨이브 보상 시스템**
   - 클리어 보상 지급
   - 보너스 조건 체크

---

## 📞 문서 관리

### 업데이트 이력
- 2025-12-04: 초안 작성

### 관련 문서
- `GDD_Overview.md` - 전체 게임 개요
- `Features/Enemy_Types.md` - 적 종류 상세
- `Systems/Shop_System.md` - 상점 시스템 (작성 예정)
- `Systems/Progression_System.md` - 진행 시스템 (작성 예정)
