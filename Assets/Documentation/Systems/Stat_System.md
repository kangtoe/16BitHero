# Stat System - 스탯 시스템 상세 기획

## 📋 문서 정보
- **작성일**: 2025-12-09
- **버전**: 1.1
- **대상**: 기획자, 디자이너, 프로그래머
- **관련 문서**:
  - [Item_System.md](Item_System.md) - 아이템 시스템
  - [Weapon_System.md](Item_System.md#1-무기-weapons) - 무기 시스템
  - [GDD_Overview.md](../GDD_Overview.md) - 게임 전체 기획

---

## 📊 스탯 시스템 개요

### 핵심 컨셉
**스탯 시스템**은 플레이어의 능력치를 정의하고 관리하는 핵심 시스템입니다.
- **13가지 스탯**으로 플레이어 능력 표현
- 무기와 장신구를 통한 스탯 변경
- 복합 계산식으로 최종 스탯 도출

### 현재 구현 상태
- ✅ PlayerStatType enum 정의
- ✅ PlayerStat 데이터 구조
- ✅ PlayerStatsManager 싱글톤
- ⚠️ 아이템 연동 미완성

### 주요 설계 결정 사항 (2025-12-09)
1. **장신구 장착 제한**: 무제한 (Brotato 방식)
2. **중복 아이템 구매**: 허용 (스택 가능)
3. **Armor 계산 공식**: % 감소 방식 채택
4. **리롤 비용**: 선형 증가 방식 유지
5. **Phase 1 범위**: 스탯 증가 아이템만 구현 (특수 효과는 Phase 2)

---

## 📈 1. 플레이어 스탯 (13가지)

### 1.1 공격 관련 스탯

#### Damage (공격력)
- **설명**: 모든 무기의 기본 데미지에 영향
- **적용 방식**: 곱셈 (%)
- **기본값**: 0% (100% 기준)
- **추천 범위**: -50% ~ +200%
- **게임플레이 영향**:
  - 적을 빠르게 처치
  - 웨이브 진행 속도 증가
  - 보스전 효율 상승

**예시**:
```
무기 기본 공격력: 15
플레이어 Damage: +20%
최종 공격력: 15 × (1 + 0.2) = 18
```

#### MeleeAttack (근접 공격력)
- **설명**: 근접 무기의 데미지만 증가
- **적용 방식**: 곱셈 (%)
- **기본값**: 0%
- **추천 범위**: -30% ~ +150%
- **게임플레이 영향**:
  - 근접 특화 빌드
  - 원거리와 Trade-off

**계산 순서**:
```
최종 근접 데미지 = 기본 데미지 × (1 + Damage%) × (1 + MeleeAttack%)
```

#### RangeAttack (원거리 공격력)
- **설명**: 원거리 무기의 데미지만 증가
- **적용 방식**: 곱셈 (%)
- **기본값**: 0%
- **추천 범위**: -30% ~ +150%
- **게임플레이 영향**:
  - 원거리 특화 빌드
  - 안전한 플레이 스타일

#### AttackSpeed (공격 속도)
- **설명**: 모든 무기의 공격 간격 감소
- **적용 방식**: 공격 딜레이 감소
- **기본값**: 0%
- **추천 범위**: -30% ~ +100%
- **게임플레이 영향**:
  - DPS 증가
  - 빠른 공격으로 안정성 향상

**계산 공식**:
```
실제 공격 간격 = 기본 공격 간격 / (1 + AttackSpeed%)

예시:
기본 공격 간격: 1.0초
AttackSpeed: +50%
실제 공격 간격: 1.0 / 1.5 = 0.67초
```

#### CriticalChance (치명타 확률)
- **설명**: 치명타 발동 확률
- **적용 방식**: 확률 (%)
- **기본값**: 0%
- **추천 범위**: 0% ~ 80%
- **게임플레이 영향**:
  - 버스트 데미지
  - 운 요소 추가
  - 치명타 배율과 시너지

**발동 로직**:
```csharp
if (Random.Range(1, 101) <= criticalChance)
{
    isCriticalHit = true;
    finalDamage *= criticalMultiplier;
}
```

#### CriticalMultiplier (치명타 배율)
- **설명**: 치명타 발동 시 데미지 배율
- **적용 방식**: 곱셈
- **기본값**: 1.5x
- **추천 범위**: 1.2x ~ 5.0x
- **게임플레이 영향**:
  - 치명타 확률과 조합
  - 높은 위험/보상 빌드

---

### 1.2 이동 및 생존 스탯

#### MoveSpeed (이동 속도)
- **설명**: 플레이어 이동 속도
- **적용 방식**: 곱셈 (%)
- **기본값**: 0% (기준 속도 5.0)
- **추천 범위**: -50% ~ +100%
- **게임플레이 영향**:
  - 회피 능력
  - 카이팅 (Kiting) 가능성
  - 아이템 수집 효율

**밸런싱 주의사항**:
- 너무 느리면 답답함 (최소 50% 이하로 제한)
- 너무 빠르면 게임이 쉬워짐 (최대 100% 제한)

#### MaxHealth (최대 체력)
- **설명**: 플레이어의 최대 HP
- **적용 방식**: 덧셈 (고정값)
- **기본값**: 100
- **추천 범위**: 50 ~ 300
- **게임플레이 영향**:
  - 생존력 직결
  - 실수 허용 범위
  - 위험한 플레이 가능

**중요**:
- 너무 낮으면 즉사 가능 (최소 50 권장)
- 너무 높으면 긴장감 저하

#### Armor (방어력)
- **설명**: 받는 데미지 감소
- **적용 방식**: % 감소 ✅ **채택됨**
- **기본값**: 0
- **추천 범위**: 0 ~ 100
- **게임플레이 영향**:
  - 지속적인 생존력
  - 체력과 시너지

**채택된 계산 공식 (% 감소)**:
```
받는 데미지 = 원본 데미지 × (1 - Armor / (Armor + 100))

예시:
적 공격력: 20
플레이어 Armor: 25
받는 데미지: 20 × (1 - 25/125) = 16 (-20% 감소)

적 공격력: 20
플레이어 Armor: 50
받는 데미지: 20 × (1 - 50/150) = 13.3 (-33% 감소)

적 공격력: 20
플레이어 Armor: 100
받는 데미지: 20 × (1 - 100/200) = 10 (-50% 감소)
```

**장점**:
- 무한정 쌓아도 100% 감소 불가 (밸런싱 안정)
- 높은 Armor일수록 효율 감소 (체감 밸런싱)
- 예측 가능한 감소율

#### HealthRecoverySpeed (체력 회복 속도)
- **설명**: 초당 자동 체력 회복량
- **적용 방식**: 초당 HP 회복
- **기본값**: 0
- **추천 범위**: 0 ~ 5 HP/s
- **게임플레이 영향**:
  - 장기전 유리
  - 포션 의존도 감소

**구현 제안**:
```csharp
void Update()
{
    if (healthRecoverySpeed > 0)
    {
        currentHealth += healthRecoverySpeed * Time.deltaTime;
        currentHealth = Mathf.Min(currentHealth, maxHealth);
    }
}
```

#### Dodge (회피)
- **설명**: 공격을 완전히 회피할 확률
- **적용 방식**: 확률 (%)
- **기본값**: 0%
- **추천 범위**: 0% ~ 50%
- **게임플레이 영향**:
  - 생존력 증가
  - 운 요소
  - 방어력과 Trade-off

**밸런싱**:
- 50% 이상은 게임을 너무 쉽게 만듦
- 체력/방어력과 선택의 문제

#### LifeSteal (생명력 흡수)
- **설명**: 입힌 데미지의 일부를 체력으로 회복
- **적용 방식**: % 회복
- **기본값**: 0%
- **추천 범위**: 0% ~ 30%
- **게임플레이 영향**:
  - 공격적인 플레이 보상
  - 높은 공격력과 시너지

**계산 공식**:
```
회복량 = 입힌 데미지 × LifeSteal%

예시:
입힌 데미지: 50
LifeSteal: 10%
회복량: 50 × 0.1 = 5 HP
```

---

### 1.3 기타 스탯

#### Range (사거리)
- **설명**: 무기의 공격 범위 증가
- **적용 방식**: 곱셈 (%)
- **기본값**: 0%
- **추천 범위**: -30% ~ +100%
- **게임플레이 영향**:
  - 안전한 공격
  - 원거리 무기와 시너지
  - 다수의 적 처리

**적용 예시**:
```
무기 기본 사거리: 5.0
Range: +20%
최종 사거리: 5.0 × 1.2 = 6.0
```

#### Luck (행운)
- **설명**: 드롭 확률 및 상점 아이템 등급 증가
- **적용 방식**: 곱셈 (%)
- **기본값**: 0%
- **추천 범위**: 0% ~ +100%
- **게임플레이 영향**:
  - 골드 획득량 증가
  - 희귀 아이템 드롭
  - 상점 고등급 아이템 출현

**적용 시스템**:
1. **드롭 확률**: `실제 확률 = 기본 확률 × (1 + Luck%)`
2. **상점 등급**: 상위 등급 확률 증가
3. **크리티컬 확률**: Luck의 일부를 크리티컬에 보너스 (선택적)

---

## 🧮 2. 스탯 계산 시스템

### 2.1 최종 스탯 계산 공식

```
최종 스탯 = ((기본 스탯 + 추가 스탯) × 스탯 배율) × 0.01
```

#### 단계별 설명

**1단계: 기본 스탯 (Base Stats)**
```
캐릭터 기본 스탯 (ScriptableObject)
예: Damage = 10
```

**2단계: 추가 스탯 (Additional Stats)**
```
아이템/무기로부터 받는 고정 증가값
예: +5 Damage (장신구에서)
```

**3단계: 스탯 배율 (Stat Multiplier)**
```
아이템/무기로부터 받는 % 증가
예: +20% Damage (무기에서)
```

**4단계: 최종 계산**
```
Damage = ((10 + 5) × (100 + 20)) × 0.01
       = (15 × 120) × 0.01
       = 1800 × 0.01
       = 18
```

### 2.2 코드 구현 (현재)

```csharp
void UpdateStats()
{
    // 1. 기본 스탯 + 추가 스탯
    var sumStats = playerCharacter.BaseStatAdjust.GetAddedStats(additionalPlayerStats);

    // 2. 스탯 배율 (100% 기준으로 변환)
    var modifyPercent = playerCharacter.StatModifier.GetAddedStats(100);

    // 3. 배율 적용
    currPlayerStat = sumStats.GetMultipliedStats(modifyPercent);

    // 4. 0.01 곱하기 (% → 실제 값)
    currPlayerStat = currPlayerStat.GetMultipliedStats(0.01f);
}
```

### 2.3 스탯 적용 예시

#### 예시 1: 단순 공격력 증가
```
기본 Damage: 10
장신구 "힘의 팔찌": +5 Damage
최종 Damage: (10 + 5) × 100 × 0.01 = 15
```

#### 예시 2: % 증가
```
기본 Damage: 10
장신구 "파괴의 문장": +40% Damage
최종 Damage: 10 × (100 + 40) × 0.01 = 14
```

#### 예시 3: 복합 증가
```
기본 Damage: 10
장신구 1 "힘의 팔찌": +5 Damage
장신구 2 "파괴의 문장": +40% Damage
최종 Damage: (10 + 5) × (100 + 40) × 0.01 = 21
```

#### 예시 4: Trade-off (긍정 + 부정)
```
기본 Damage: 10
장신구 "파괴의 문장":
  - +40% Damage
  - -50% Armor

최종 Damage: 10 × (100 + 40) × 0.01 = 14
최종 Armor: 20 × (100 - 50) × 0.01 = 10
```

---

## 🎯 3. 스탯 밸런싱 가이드

### 3.1 스탯 가치 (Stat Value)

각 스탯의 상대적 가치:

| 스탯 | 가치 | 설명 |
|:---|:---:|:---|
| Damage | 1.0 | 기준 스탯 |
| MeleeAttack | 0.8 | 조건부 (근접만) |
| RangeAttack | 0.8 | 조건부 (원거리만) |
| AttackSpeed | 1.2 | DPS에 직접 영향 |
| CriticalChance | 1.5 | 배율과 조합 시 강력 |
| CriticalMultiplier | 1.0 | 확률과 조합 필요 |
| MoveSpeed | 1.3 | 생존력 직결 |
| MaxHealth | 0.5 | 고정값 |
| Range | 0.7 | 편의성 |
| HealthRecovery | 0.9 | 장기전 유리 |
| Armor | 1.0 | 지속 생존력 |
| Luck | 0.6 | 간접 효과 |
| Dodge | 1.8 | 확률 기반, 강력 |
| LifeSteal | 1.1 | 공격과 시너지 |

### 3.2 스탯 밸런싱 공식 (제안)

#### 아이템 가격 산정
```
아이템 가격 = 기본 가격 + Σ(스탯 증가량 × 스탯 가치)

예시:
장신구 "강철 갑옷"
- 기본 가격: 20
- +5 Armor (5 × 1.0 = 5)
- -5% MoveSpeed (|-5| × 1.3 × 0.5 = 3.25)
총 가치: 5 + 3.25 = 8.25
최종 가격: 20 + 8 = 28 → 30 (반올림)
```

### 3.3 빌드 밸런싱

#### 공격 특화 빌드
**목표 스탯**:
- Damage: +100~150%
- AttackSpeed: +50~80%
- CriticalChance: +30~50%
- MoveSpeed: -20~-30% (Trade-off)
- MaxHealth: -30~-50 (Trade-off)

**특징**: 높은 DPS, 낮은 생존력

#### 생존 특화 빌드
**목표 스탯**:
- MaxHealth: +100~150
- Armor: +30~50
- Dodge: +20~30%
- HealthRecovery: +3~5 HP/s
- Damage: -20~-30% (Trade-off)
- AttackSpeed: -20~-30% (Trade-off)

**특징**: 높은 생존력, 낮은 DPS

#### 균형 빌드
**목표 스탯**:
- Damage: +50~80%
- AttackSpeed: +30~50%
- MaxHealth: +50~80
- MoveSpeed: +20~40%
- 큰 Trade-off 없음

**특징**: 안정적, 만능형

---

## 📊 4. 스탯 UI 표시

### 4.1 UI 구성 (제안)

```
+-------------------------------------------------------+
|  [플레이어 스탯]                                        |
+-------------------------------------------------------+
|  ⚔️ 공격력        | 150%   [+50%]                      |
|  ⚡ 공격 속도      | 130%   [+30%]                      |
|  🎯 치명타 확률    | 25%    [+25%]                      |
|  💥 치명타 배율    | 2.0x   [+0.5x]                     |
|  🏃 이동 속도      | 85%    [-15%]                      |
|  ❤️ 최대 체력      | 120    [+20]                       |
|  🛡️ 방어력        | 15     [+15]                       |
|  🍀 행운         | 20%    [+20%]                      |
+-------------------------------------------------------+
```

### 4.2 툴팁 표시

```
공격력: 150%
├─ 기본: 100%
├─ 무기: +20% (검 ×2)
├─ 장신구: +30% (날카로운 칼날, 파괴의 문장)
└─ 최종: 150%
```

---

## 🔧 5. 구현 가이드

### 5.1 필요한 기능 (PlayerStatsManager)

```csharp
// 아이템에서 스탯 추가
public void AddStatModifier(ItemDataSO item)
{
    foreach (var modifier in item.statModifiers)
    {
        additionalPlayerStats.AddStat(modifier);
    }
    UpdateStats();
}

// 아이템에서 스탯 제거 (무기 교체 시)
public void RemoveStatModifier(ItemDataSO item)
{
    foreach (var modifier in item.statModifiers)
    {
        additionalPlayerStats.RemoveStat(modifier);
    }
    UpdateStats();
}

// 특정 스탯 값 조회
public int GetStatValue(PlayerStatType statType)
{
    return currPlayerStat.GetStatValue(statType);
}

// 모든 스탯 조회
public PlayerStat GetCurrentStats()
{
    return currPlayerStat;
}
```

### 5.2 아이템 적용 흐름

```
1. 플레이어가 아이템 구매
2. ItemDataSO의 statModifiers 읽기
3. PlayerStatsManager.AddStatModifier() 호출
4. UpdateStats() 실행
5. 무기/캐릭터에 스탯 반영
6. UI 업데이트
```

---

## 📝 6. 참고사항

### 6.1 Brotato와의 비교
- **유사점**:
  - Trade-off 시스템
  - 복합 스탯 계산
  - % 기반 증가

- **차이점**:
  - 13가지 스탯 (Brotato보다 단순)
  - 고정값 + % 혼합 시스템

### 6.2 확장 가능성
- **스탯 상한/하한**: 너무 극단적인 값 방지
- **스탯 시너지**: 특정 스탯 조합 시 보너스
- **동적 스탯**: 상황에 따라 변하는 스탯
- **디버프 면역**: 특정 스탯에 부정 효과 무시

---

## 📞 문서 관리

### 업데이트 이력
- 2025-12-09: 초안 작성

### 다음 작업
1. PlayerStatsManager 확장 구현
2. 아이템과 스탯 연동
3. 밸런싱 테스트
4. UI 개선

### 관련 문서
- [Item_System.md](Item_System.md) - 아이템 시스템 기획
- [GDD_Overview.md](../GDD_Overview.md) - 게임 전체 기획
- [Architecture.md](../Technical/Architecture.md) - 아키텍처 문서
