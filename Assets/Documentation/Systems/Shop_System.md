# Shop System - 상점 시스템 상세 기획

## 📋 문서 정보
- **작성일**: 2025-12-08
- **버전**: 0.1
- **관련 시스템**: Economy System, Progression System, Weapon System

---

## 🏪 상점 시스템 개요

### 핵심 컨셉
웨이브와 웨이브 사이에 플레이어가 획득한 재화(골드)를 사용하여 캐릭터를 강화하는 정비 단계입니다. 랜덤하게 제시되는 아이템 중 최적의 선택을 하는 전략적 요소가 핵심입니다.

### 게임 루프 내 위치
```
[웨이브 종료] → [상점 진입] → [정비/구매] → [다음 웨이브 시작]
```

---

## 🔧 기능 명세

### 1. 상점 슬롯 (Shop Slots)
- **기본 슬롯 수**: 4개
- **갱신 방식**:
  - 웨이브 진입 시 자동 갱신 (잠금된 슬롯 제외)
  - '리롤' 버튼 클릭 시 즉시 갱신
- **등장 확률**:
  - 현재 웨이브 스테이지와 플레이어 '행운(Luck)' 스탯에 따라 아이템 등급(Tier 1~4) 확률 보정

### 2. 구매 (Purchase)
- 슬롯 클릭 시 아이템 상세 정보 표시
- '구매' 버튼 클릭 시 골드 차감 후 아이템 획득
- 구매한 슬롯은 '품절(Sold Out)' 상태 또는 비워짐
- **무기 구매 시**:
  - 무기 인벤토리(최대 6칸)에 빈 공간이 있어야 함
  - 공간 부족 시 '교체' 또는 '합성' (동일 등급/종류 일 경우) 유도
- **아이템 구매 시**:
  - 패시브 아이템은 개수 제한 없음 (또는 슬롯 제한 없음)
  - 즉시 스탯 적용

### 3. 리롤 (Reroll)
- **기능**: 상점의 모든 아이템(잠금 제외)을 새로운 아이템으로 교체
- **가격**:
  - 기본 가격: `웨이브 수 * 상수` (예: 웨이브 1 = 5골드, 웨이브 10 = 50골드)
  - 횟수별 가격 증가: 한 상점 세션 내에서 리롤 할 때마다 가격 증가 (예: +50% 씩)
  - 다음 웨이브 시 초기 가격으로 리셋

### 4. 잠금 (Lock)
- **기능**: 특정 슬롯의 아이템을 다음 리롤이나 다음 웨이브 상점에서도 유지
- **사용처**: 현재 골드가 부족하지만 꼭 사고 싶은 아이템이 나왔을 때 사용
- **해제**: 다시 클릭하여 잠금 해제

### 5. 재활용/판매 (Recycle) - *선택적* [추후 구현]
- 보유 중인 무기를 판매하여 일부 골드 환급 (예: 구매가의 25%)

---

## 📊 경제 및 밸런싱

### 아이템 가격 책정 (예시)
| 등급 (Tier) | 기본 가격 | 비고 |
|:---:|:---:|:---|
| 1 (Common) | 15 ~ 30 Gold | 초반 접근성 |
| 2 (Uncommon) | 40 ~ 70 Gold | |
| 3 (Rare) | 90 ~ 150 Gold | 확실한 성능 향상 |
| 4 (Legendary) | 250+ Gold | 게임 체인저 |

### 리롤 비용 공식 ✅ **채택됨**
```
리롤 비용 = 기본 비용 + (현재 웨이브 * 2) + (이번 상점 리롤 횟수 * 5)

예시:
웨이브 1, 1회 리롤: 5 + (1 * 2) + (1 * 5) = 12 골드
웨이브 1, 2회 리롤: 5 + (1 * 2) + (2 * 5) = 17 골드
웨이브 5, 1회 리롤: 5 + (5 * 2) + (1 * 5) = 20 골드
웨이브 10, 1회 리롤: 5 + (10 * 2) + (1 * 5) = 30 골드
```

**특징**:
- 선형 증가로 예측 가능
- 웨이브가 높을수록 기본 비용 상승
- 같은 웨이브 내 반복 리롤 시 추가 비용

---

## 🖼️ UI 구성 (Mockup 아이디어)

### 레이아웃
```
+-------------------------------------------------------+
|  [Wave 5 완료]                보유 골드: 💰 125       |
+-------------------------------------------------------+
|                                                       |
|  [상점 슬롯 1]  [상점 슬롯 2]  [상점 슬롯 3]  [상점 슬롯 4] |
|   (아이템)       (무기)         (아이템)       (잠금됨)   |
|   💰 50          💰 100         💰 30          🔒 200    |
|                                                       |
+-------------------------------------------------------+
|  [Reroll 💰 5]               [ GO (다음 웨이브) >> ]   |
+-------------------------------------------------------+
|                                                       |
|  [내 무기 (6/6)]                                      |
|  ⚔️ ⚔️ ⚔️ ⚔️ ⚔️ ⚔️                                   |
|                                                       |
|  [내 스탯 요약]                                       |
|  HP: 20/20 | DMG: +15% | ASPD: +10% ...               |
+-------------------------------------------------------+
```

---

## 🧩 데이터 구조 가이드

### ShopItemData (ScriptableObject)
상점에 등장할 수 있는 모든 아이템의 데이터 베이스 필요
- `Name`: 아이템 이름
- `Icon`: 아이콘
- `Description`: 설명
- `Type`: Weapon / Passive / Consumable
- `Tier`: 1~4
- `BasePrice`: 기본 가격
- `Stats`: 적용될 스탯 효과 (List<StatModifier>)

### ShopManager (Singleton)
- `Reroll()`
- `BuyItem(int slotIndex)`
- `LockItem(int slotIndex)`
- `NextWave()`

---

## ✅ 구현 체크리스트

### Phase 1 (기본 기능)
- [ ] 상점 UI 기본 레이아웃 구성
- [ ] ShopManager 스크립트 생성
- [ ] 아이템 데이터베이스 연동 (무기/아이템 리스트)
- [ ] 랜덤 아이템 뽑기 로직 (Simple Random)
- [ ] 구매 기능 (골드 차감, 인벤토리 추가)
- [ ] 다음 웨이브 버튼 (GameManager 연동)

### Phase 2 (편의성 및 심화)
- [ ] 리롤 기능 구현
- [ ] 아이템 잠금 기능 구현
- [ ] 아이템 등장 확률 가중치 (Tier 기반)
- [ ] 플레이어 스탯 UI 표시

### Phase 3 (완성도)
- [ ] 무기 합성 시스템 (같은 무기 2개 = 상위 등급)
- [ ] 아이템 툴팁 및 상세 정보 팝업
- [ ] 상점 입장/퇴장 애니메이션

